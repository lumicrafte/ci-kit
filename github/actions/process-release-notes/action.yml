name: "Process Release Notes"
description: "Processes release notes for Play Store in multiple languages"

inputs:
  release-notes:
    description: "Release notes: plain text for en-US, or XML-like tags for multiple languages: <en-US>text</en-US><es-ES>texto</es-ES>"
    required: true

runs:
  using: "composite"
  steps:
    - name: Create release notes files
      shell: bash
      run: |
        mkdir -p whatsnew

        NOTES='${{ inputs.release-notes }}'

        # Check if input contains language tags like <en-US>...</en-US>
        if echo "$NOTES" | grep -qE '<[a-z]{2}-[A-Z]{2}>'; then
          echo "Processing multilingual release notes (XML-like format)..."

          # Extract each language tag and create corresponding files
          echo "$NOTES" | grep -oP '<[a-z]{2}-[A-Z]{2}>.*?</[a-z]{2}-[A-Z]{2}>' | while read -r tag; do
            # Extract locale code (e.g., en-US from <en-US>text</en-US>)
            LOCALE=$(echo "$tag" | grep -oP '(?<=<)[a-z]{2}-[A-Z]{2}(?=>)')
            # Extract content between tags
            CONTENT=$(echo "$tag" | sed -E "s|<$LOCALE>(.*)</$LOCALE>|\1|")

            echo "$CONTENT" > "whatsnew/whatsnew-$LOCALE"
            echo "✓ Created whatsnew-$LOCALE"
          done

          echo ""
          echo "Release notes created for languages:"
          ls -1 whatsnew/
        else
          echo "Processing single language release notes (plain text)..."
          echo "$NOTES" > whatsnew/whatsnew-en-US
          echo "✓ Created whatsnew-en-US"
        fi

        echo ""
        echo "Release notes contents:"
        for file in whatsnew/*; do
          echo "--- $(basename $file) ---"
          cat "$file"
          echo ""
        done
